================================================================================
                    ADMINBLOCK - ROADMAP DE MEJORAS
================================================================================

================================================================================
‚úÖ COMPLETADO
================================================================================

1. Reports - Excel Export
   - Exportar pedidos del mes
   - Exportar pedidos por rango de fechas
   - Exportar lista de clientes

2. WhatsApp Settings Toggle
   - Configurar notificaciones autom√°ticas por estado
   - Toggle para activar/desactivar cada tipo de mensaje

3. Sistema de Proveedores, Materiales y Cotizaci√≥n
   - [x] Crear tabla de materiales (nombre, unidad, notas)
   - [x] Crear tabla de proveedores (nombre, tel√©fono, direcci√≥n, notas)
   - [x] Crear tabla proveedor_materiales (qu√© materiales ofrece cada proveedor)
   - [x] Crear tabla de materiales por servicio (qu√© materiales usa cada tipo)
   - [x] Crear tabla de materiales por pedido (materiales usados en cada orden)
   - [x] Crear tabla de cotizaciones (quotes) y quote_materials
   - [x] API CRUD para materiales
   - [x] API CRUD para proveedores
   - [x] API CRUD para supplier_materials
   - [x] API CRUD para quotes
   - [x] UI para gestionar cat√°logo de materiales (Ajustes > Materiales)
   - [x] UI para gestionar proveedores (Ajustes > Proveedores)
   - [x] UI para asignar materiales a proveedores con precios
   - [x] UI para configurar materiales por servicio
   - [x] UI Cotizador: seleccionar materiales, proveedor y precio
   - [x] Calcular costo total + margen de ganancia
   - [x] Guardar cotizaciones y convertirlas en pedidos
   - [x] Actualizar order_materials para guardar proveedor usado

4. Soft Delete para Pedidos Listos
   - [x] Agregar campo isArchived a tabla orders
   - [x] Filtrar pedidos archivados por defecto en API
   - [x] API para archivar/desarchivar pedidos
   - [x] UI toggle para ver pedidos archivados
   - [x] Bot√≥n "Archivar" para pedidos entregados + pagados

5. Limpieza y Mejoras de C√≥digo
   - [x] Remover console.log statements (78 encontrados en producci√≥n)
   - [x] Eliminar tipos TypeScript "any" (3 usos encontrados)
   - [x] Agregar error boundaries para manejo de errores React
   - [x] Reemplazar alert/confirm nativos con shadcn dialogs
   - [x] Agregar loading states a mutaciones (archive, unarchive, etc)
   - [x] Corregir acentos espa√±oles: Encuadernaci√≥n, Folleter√≠a, Carteler√≠a
   - [x] Deprecar tabla legacy "contacts" (migrar a clientRelationships)
   - [x] Extraer l√≥gica hardcodeada de tel√©fonos AR a config/env
   - [x] Estandarizar formato de errores en API responses
   - [x] Agregar √≠ndices DB para queries frecuentes (clientId, status, isArchived)

6. Dialogs + Toasts (shadcn/ui)
   - [x] Reemplazar confirm() nativo con AlertDialog
   - [x] Agregar Toaster para feedback de acciones
   - [x] Mejor UX en m√≥vil con componentes touch-friendly

7. Edici√≥n de Entidades
   - [x] Modal para editar pedidos existentes (descripci√≥n, precio, fecha)
   - [x] Modal para editar clientes existentes
   - [x] B√∫squeda/filtro en p√°gina de pedidos

================================================================================
‚è≥ PENDIENTE - ALTA PRIORIDAD
================================================================================

8. Servicios Din√°micos
   - Permitir crear nuevos tipos de servicio desde el sistema
   - Editar servicios existentes
   - Asignar materiales a cada servicio din√°micamente

================================================================================
‚è≥ PENDIENTE - MEDIA PRIORIDAD
================================================================================

9. Sistema de Roles
   - ROL ADMIN: Pap√°, T√≠o - acceso completo
   - ROL OPERADOR: Mam√°, Hermana - solo crear clientes/pedidos
   - Restringir acceso a configuraci√≥n y cotizaci√≥n

10. Auditor√≠a
   - Ver qui√©n hizo cada acci√≥n
   - Ver cu√°ndo se hizo cada acci√≥n
   - Ver qu√© cambi√≥ en cada acci√≥n
   - UI para ver historial de actividad

11. Optimizaci√≥n Stats API
   - Usar SQL aggregations en vez de cargar todos los pedidos
   - Mejorar performance del dashboard

================================================================================
‚è≥ PENDIENTE - BAJA PRIORIDAD / FUTURO
================================================================================

12. WhatsApp Incoming
    - Recibir comprobantes de pago autom√°ticamente por WhatsApp
    - Asociar PDFs a pedidos por n√∫mero de tel√©fono
    - Enviar recordatorios a clientes que no retiran

13. Calendario
    - Vista de pedidos por fecha
    - Ver entregas programadas
    - Vista semanal/mensual

14. Facturaci√≥n ‚úÖ COMPLETADO (Feb 2026)
    - [x] Agregar campos de facturaci√≥n a pedidos (invoiceNumber, invoiceType, quantity, subtotal, taxAmount)
    - [x] Agregar CUIT a clientes
    - [x] Crear utilidades de c√°lculo de IVA (21%)
    - [x] UI para editar facturas en pedidos
    - [x] Soporte para Factura A (con IVA) y Factura B (monotributo)
    - [ ] Generar PDFs de facturas (futuro)
    - [ ] Integraci√≥n con AFIP (futuro)

15. PWA / App Instalable
    - Hacer la app instalable en m√≥vil
    - Notificaciones push

16. Dark Mode
    - Toggle para cambiar tema claro/oscuro

================================================================================
üìã CODE REVIEW - ISSUES ENCONTRADOS (Feb 2026)
================================================================================

üî¥ CR√çTICOS - REQUIEREN ATENCI√ìN INMEDIATA
-------------------------------------------

1. Database Schema Mismatch - Invoice Type
   - Schema define invoiceTypeEnum pero migraci√≥n usa TEXT
   - Fix: Actualizar migraci√≥n para usar enum o cambiar schema a TEXT
   - Ubicaci√≥n: migrations/add_invoice_fields_simple.sql:9

2. Missing Error Boundaries
   - No hay error boundaries para capturar crashes de componentes
   - Impacto: Crashes se propagan al usuario, mala UX
   - Fix: Agregar error boundaries a nivel de rutas

3. Unsafe Type Assertions
   - Uso de 'as' sin validaci√≥n
   - Ejemplo: invoiceType: (order.invoiceType as "A" | "B" | "none")
   - Riesgo: Errores en runtime si los datos no coinciden

4. No Request Timeouts
   - Los fetch pueden colgar infinitamente
   - Causa del bug "Guardando..." que viste
   - Fix: Agregar AbortController o timeout wrapper

üü° IMPORTANTES - ARREGLAR PRONTO
---------------------------------

5. Inconsistent Soft Delete
   - isArchived/isActive usan TEXT con "true"/"false" en vez de boolean
   - Afecta: orders.isArchived, suppliers.isActive, materials.isActive
   - Fix: Migrar a boolean o crear helpers consistentes

6. Missing Input Validation on Invoice Calculations
   - No valida n√∫meros negativos o NaN en calculateIVA()
   - Ubicaci√≥n: src/lib/utils/invoice.ts
   - Fix: Agregar validaci√≥n de inputs

7. Inconsistent Error Messages
   - Mix de espa√±ol/ingl√©s en errores
   - Fix: Estandarizar todos los mensajes

8. Missing Database Indexes
   - Faltan √≠ndices en: orders.status, orders.clientId, orders.paymentStatus, clients.clientType
   - Impacto: Queries lentas a medida que crece la data
   - Fix: Agregar √≠ndices en migraci√≥n

9. Duplicate Client System
   - Tabla 'contacts' (legacy) y 'clientRelationships' hacen lo mismo
   - Fix: Migrar todos los contacts a clientRelationships y eliminar tabla

10. No Input Sanitization
    - Sin protecci√≥n XSS en inputs
    - Riesgo: Vulnerabilidad de seguridad
    - Fix: Sanitizar inputs especialmente en notes/description

üü¢ MEJORAS MENORES - NICE TO HAVE
----------------------------------

11. Hardcoded IVA Rate
    - IVA_RATE = 0.21 est√° hardcodeado
    - Fix: Mover a app settings para flexibilidad

12. No Pagination
    - Se cargan todos los registros sin paginaci√≥n
    - Impacto: Performance degradada con datasets grandes
    - Fix: Implementar cursor-based pagination

13. Missing Loading States
    - Algunos botones no muestran loading (archive/unarchive)
    - Fix: Agregar estados de loading consistentes

14. No Optimistic Updates
    - UI no se actualiza optim√≠sticamente
    - Impacto: Performance percibida lenta
    - Fix: Agregar optimistic updates en React Query

15. Inconsistent Date Handling
    - Mix de Date objects, ISO strings, date strings
    - Riesgo: Bugs de timezone
    - Fix: Estandarizar en ISO strings

16. No Rate Limiting
    - APIs sin rate limiting
    - Riesgo: Abuso o DoS
    - Fix: Agregar middleware de rate limiting

17. TypeScript Not in Strict Mode
    - tsconfig.json no usa strict mode
    - Fix: Habilitar strict mode para mejor type safety

18. No Structured Logging
    - Solo console.error para logging
    - Problema: Dif√≠cil debuggear en producci√≥n
    - Fix: Implementar logging estructurado (Pino, Winston)

19. No Retry Logic
    - Requests fallidos no reintentan
    - Impacto: Mala UX en problemas de red
    - Fix: Agregar retry logic a React Query

20. Missing Frontend Validation
    - Algunos forms no validan antes de submit
    - Ejemplo: Formato CUIT no se valida
    - Fix: Agregar validaci√≥n frontend matching backend schemas

üìä PERFORMANCE
--------------

21. N+1 Query Problem
    - Fetching de data relacionada en loops
    - Fix: Usar Drizzle's 'with' para eager loading

22. Large Bundle Size
    - Sin code splitting para componentes grandes
    - Fix: Usar dynamic imports para modals y componentes pesados

23. No Caching Strategy
    - Sin headers de HTTP caching
    - Fix: Agregar Cache-Control headers apropiados

üîí SEGURIDAD
------------

24. No CSRF Protection
    - Sin validaci√≥n de CSRF tokens
    - Riesgo: Ataques de cross-site request forgery
    - Fix: Implementar protecci√≥n CSRF

25. Sensitive Data in Logs
    - Objetos de error completos en logs (pueden contener data sensible)
    - Fix: Sanitizar logs antes de loggear

26. SQL Injection (Verificar)
    - Drizzle ORM deber√≠a proteger, pero necesita verificaci√≥n
    - Fix: Auditar todas las raw SQL queries si existen

üéØ PRIORIDADES RECOMENDADAS
---------------------------

ALTA PRIORIDAD (Arreglar Ya):
1. Fix invoice_type enum/TEXT mismatch
2. Agregar request timeouts
3. Agregar √≠ndices faltantes en DB
4. Implementar error boundaries
5. Fix soft delete inconsistency

MEDIA PRIORIDAD (Arreglar Pronto):
6. Migrar contacts a clientRelationships
7. Agregar validaci√≥n y sanitizaci√≥n de inputs
8. Implementar paginaci√≥n
9. Agregar manejo de errores apropiado
10. Estandarizar mensajes de error

BAJA PRIORIDAD (Nice to Have):
11. Agregar optimistic updates
12. Implementar code splitting
13. Agregar logging estructurado
14. Habilitar TypeScript strict mode
15. Agregar rate limiting

================================================================================
                         FIN DEL ROADMAP
================================================================================