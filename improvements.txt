================================================================================
                    ADMINBLOCK - ROADMAP DE MEJORAS
================================================================================

================================================================================
‚úÖ COMPLETADO
================================================================================

    1. Reports - Excel Export
    - Exportar pedidos del mes
    - Exportar pedidos por rango de fechas
    - Exportar lista de clientes

    2. WhatsApp Settings Toggle
    - Configurar notificaciones autom√°ticas por estado
    - Toggle para activar/desactivar cada tipo de mensaje

    3. Sistema de Proveedores, Materiales y Cotizaci√≥n
    - [x] Crear tabla de materiales (nombre, unidad, notas)
    - [x] Crear tabla de proveedores (nombre, tel√©fono, direcci√≥n, notas)
    - [x] Crear tabla proveedor_materiales (qu√© materiales ofrece cada proveedor)
    - [x] Crear tabla de materiales por servicio (qu√© materiales usa cada tipo)
    - [x] Crear tabla de materiales por pedido (materiales usados en cada orden)
    - [x] Crear tabla de cotizaciones (quotes) y quote_materials
    - [x] API CRUD para materiales
    - [x] API CRUD para proveedores
    - [x] API CRUD para supplier_materials
    - [x] API CRUD para quotes
    - [x] UI para gestionar cat√°logo de materiales (Ajustes > Materiales)
    - [x] UI para gestionar proveedores (Ajustes > Proveedores)
    - [x] UI para asignar materiales a proveedores con precios
    - [x] UI para configurar materiales por servicio
    - [x] UI Cotizador: seleccionar materiales, proveedor y precio
    - [x] Calcular costo total + margen de ganancia
    - [x] Guardar cotizaciones y convertirlas en pedidos
    - [x] Actualizar order_materials para guardar proveedor usado

    4. Soft Delete para Pedidos Listos
    - [x] Agregar campo isArchived a tabla orders
    - [x] Filtrar pedidos archivados por defecto en API
    - [x] API para archivar/desarchivar pedidos
    - [x] UI toggle para ver pedidos archivados
    - [x] Bot√≥n "Archivar" para pedidos entregados + pagados

    5. Limpieza y Mejoras de C√≥digo
    - [x] Remover console.log statements (78 encontrados en producci√≥n)
    - [x] Eliminar tipos TypeScript "any" (3 usos encontrados)
    - [x] Agregar error boundaries para manejo de errores React
    - [x] Reemplazar alert/confirm nativos con shadcn dialogs
    - [x] Agregar loading states a mutaciones (archive, unarchive, etc)
    - [x] Corregir acentos espa√±oles: Encuadernaci√≥n, Folleter√≠a, Carteler√≠a
    - [x] Deprecar tabla legacy "contacts" (migrar a clientRelationships)
    - [x] Extraer l√≥gica hardcodeada de tel√©fonos AR a config/env
    - [x] Estandarizar formato de errores en API responses
    - [x] Agregar √≠ndices DB para queries frecuentes (clientId, status, isArchived)

    6. Dialogs + Toasts (shadcn/ui)
    - [x] Reemplazar confirm() nativo con AlertDialog
    - [x] Agregar Toaster para feedback de acciones
    - [x] Mejor UX en m√≥vil con componentes touch-friendly

    7. Edici√≥n de Entidades
    - [x] Modal para editar pedidos existentes (descripci√≥n, precio, fecha)
    - [x] Modal para editar clientes existentes
    - [x] B√∫squeda/filtro en p√°gina de pedidos

    8. Servicios Din√°micos 
    - [x] Crear tabla de servicios en base de datos
    - [x] Migraci√≥n de enum a TEXT para service_type
    - [x] API CRUD para servicios (/api/services)
    - [x] Hooks para gesti√≥n de servicios (use-services.ts)
    - [x] Validaciones actualizadas para servicios din√°micos
    - [x] Message templates actualizados
    - [x] UI para gestionar servicios en Settings
    - [x] Actualizar forms de pedidos con dropdown din√°mico

    9. Facturaci√≥n 
    - [x] Agregar campos de facturaci√≥n a pedidos 
    (invoiceNumber, invoiceType, quantity, subtotal, taxAmount)
    - [x] Agregar CUIT a clientes
    - [x] Crear utilidades de c√°lculo de IVA (21%)
    - [x] UI para editar facturas en pedidos
    - [x] Soporte para Factura A (con IVA) y Factura B (monotributo)
    - [ ] Generar PDFs de facturas (futuro)
    - [ ] Integraci√≥n con AFIP (futuro)

    10. Optimizaciones de Performance (Feb 2026)
    - [x] Agregar √≠ndices de base de datos (migration 005)
    - [x] √çndices simples: paymentStatus, dueDate, createdAt, updatedAt, clientType
    - [x] √çndices parciales para queries comunes (active orders, unpaid, non-archived)
    - [x] √çndices compuestos para filtros combinados
    - [x] Optimizar Stats API con SQL aggregations (50-100x m√°s r√°pido)
    - [x] Queries paralelas con Promise.all() en Stats API
    - Resultado: Dashboard 50-100x m√°s r√°pido, listas 5-10x m√°s r√°pidas

================================================================================
 PENDIENTE - ALTA PRIORIDAD
================================================================================

    1. Sistema de Roles
    - ROL ADMIN: Pap√°, T√≠o - acceso completo
    - ROL OPERADOR: Mam√°, Hermana - solo crear clientes/pedidos
    - Restringir acceso a configuraci√≥n y cotizaci√≥n

    2. Auditor√≠a
    - Ver qui√©n hizo cada acci√≥n
    - Ver cu√°ndo se hizo cada acci√≥n
    - Ver qu√© cambi√≥ en cada acci√≥n
    - UI para ver historial de actividad

================================================================================
üîß OPTIMIZACIONES T√âCNICAS - SOLO SI ESCALA EL NEGOCIO
================================================================================

    Estas mejoras son para cuando el volumen de datos crezca significativamente.
    No son necesarias ahora pero ser√°n importantes con miles de registros o alto tr√°fico.

    1. Paginaci√≥n
    - Implementar cursor-based pagination en listas
    - Necesario cuando: > 1000 registros por entidad

    2. N+1 Query Optimization
    - Usar Drizzle's 'with' para eager loading
    - Necesario cuando: Queries tarden > 2 segundos

    4. Rate Limiting
    - Agregar middleware de rate limiting en APIs
    - Necesario cuando: Alto tr√°fico o riesgo de abuso/DoS

    5. Structured Logging
    - Implementar logging estructurado (Pino, Winston)
    - Necesario cuando: Dif√≠cil debuggear en producci√≥n con muchos usuarios

    6. Code Splitting / Bundle Optimization
    - Usar dynamic imports para modals y componentes pesados
    - Necesario cuando: Bundle size afecte carga inicial

    7. HTTP Caching Strategy
    - Agregar Cache-Control headers apropiados
    - Necesario cuando: Alto tr√°fico requiera optimizaci√≥n de red

    8. CSRF Protection
    - Implementar validaci√≥n de CSRF tokens
    - Necesario cuando: App sea p√∫blica o tenga muchos usuarios externos

    9. Optimistic Updates
    - UI no se actualiza optim√≠sticamente en React Query
    - Necesario cuando: Performance percibida sea lenta con muchos usuarios

    10. Retry Logic
    - Agregar retry logic a React Query para requests fallidos
    - Necesario cuando: Problemas de red sean frecuentes

================================================================================
‚è≥ PENDIENTE - BAJA PRIORIDAD / FUTURO
================================================================================

    12. WhatsApp Incoming
        - Recibir comprobantes de pago autom√°ticamente por WhatsApp
        - Asociar PDFs a pedidos por n√∫mero de tel√©fono
        - Enviar recordatorios a clientes que no retiran

    13. Calendario
        - Vista de pedidos por fecha
        - Ver entregas programadas
        - Vista semanal/mensual

    14. Facturaci√≥n ‚úÖ COMPLETADO (Feb 2026)
        - [x] Agregar campos de facturaci√≥n a pedidos (invoiceNumber, invoiceType, quantity, subtotal, taxAmount)
        - [x] Agregar CUIT a clientes
        - [x] Crear utilidades de c√°lculo de IVA (21%)
        - [x] UI para editar facturas en pedidos
        - [x] Soporte para Factura A (con IVA) y Factura B (monotributo)
        - [ ] Generar PDFs de facturas (futuro)
        - [ ] Integraci√≥n con AFIP (futuro)

    15. PWA / App Instalable
        - Hacer la app instalable en m√≥vil
        - Notificaciones push

    16. Dark Mode
        - Toggle para cambiar tema claro/oscuro

================================================================================
üìã CODE REVIEW - ISSUES ENCONTRADOS (Feb 2026)
================================================================================

üî¥ CR√çTICOS - REQUIEREN ATENCI√ìN INMEDIATA
-------------------------------------------

    1. Database Schema Mismatch - Invoice Type
    - Schema define invoiceTypeEnum pero migraci√≥n usa TEXT
    - Fix: Actualizar migraci√≥n para usar enum o cambiar schema a TEXT
    - Ubicaci√≥n: migrations/add_invoice_fields_simple.sql:9

    2. Missing Error Boundaries
    - No hay error boundaries para capturar crashes de componentes
    - Impacto: Crashes se propagan al usuario, mala UX
    - Fix: Agregar error boundaries a nivel de rutas

    3. Unsafe Type Assertions
    - Uso de 'as' sin validaci√≥n
    - Ejemplo: invoiceType: (order.invoiceType as "A" | "B" | "none")
    - Riesgo: Errores en runtime si los datos no coinciden

üü° IMPORTANTES - ARREGLAR PRONTO
---------------------------------

    5. Inconsistent Soft Delete
    - isArchived/isActive usan TEXT con "true"/"false" en vez de boolean
    - Afecta: orders.isArchived, suppliers.isActive, materials.isActive
    - Fix: Migrar a boolean o crear helpers consistentes

    6. Missing Input Validation on Invoice Calculations
    - No valida n√∫meros negativos o NaN en calculateIVA()
    - Ubicaci√≥n: src/lib/utils/invoice.ts
    - Fix: Agregar validaci√≥n de inputs

    7. Inconsistent Error Messages
    - Mix de espa√±ol/ingl√©s en errores
    - Fix: Estandarizar todos los mensajes

    8. Missing Database Indexes ‚úÖ COMPLETADO (Feb 2026)
    - [x] Ya agregados: orders.clientId, orders.status, orders.isArchived
    - [x] Agregados: orders.paymentStatus, orders.dueDate, orders.createdAt, orders.updatedAt
    - [x] Agregados: clients.clientType, clients.createdAt
    - [x] √çndices parciales para queries comunes (active orders, unpaid, non-archived)
    - [x] √çndices compuestos para filtros combinados
    - Migraci√≥n: 005_add_performance_indexes.sql

    9. Duplicate Client System
    - Tabla 'contacts' (legacy) y 'clientRelationships' hacen lo mismo
    - Fix: Migrar todos los contacts a clientRelationships y eliminar tabla

    10. No Input Sanitization
        - Sin protecci√≥n XSS en inputs
        - Riesgo: Vulnerabilidad de seguridad
        - Fix: Sanitizar inputs especialmente en notes/description

üü¢ MEJORAS MENORES - NICE TO HAVE
----------------------------------

    11. Hardcoded IVA Rate
        - IVA_RATE = 0.21 est√° hardcodeado
        - Fix: Mover a app settings para flexibilidad

    12. Missing Loading States
        - Algunos botones no muestran loading (archive/unarchive)
        - Fix: Agregar estados de loading consistentes

    13. Inconsistent Date Handling
        - Mix de Date objects, ISO strings, date strings
        - Riesgo: Bugs de timezone
        - Fix: Estandarizar en ISO strings

    14. TypeScript Not in Strict Mode
        - tsconfig.json no usa strict mode
        - Fix: Habilitar strict mode para mejor type safety

    15. Missing Frontend Validation
        - Algunos forms no validan antes de submit
        - Ejemplo: Formato CUIT no se valida
        - Fix: Agregar validaci√≥n frontend matching backend schemas

üîí SEGURIDAD
------------

    18. Sensitive Data in Logs
        - Objetos de error completos en logs (pueden contener data sensible)
        - Fix: Sanitizar logs antes de loggear

    19. SQL Injection (Verificar)
        - Drizzle ORM deber√≠a proteger, pero necesita verificaci√≥n
        - Fix: Auditar todas las raw SQL queries si existen

üéØ PRIORIDADES RECOMENDADAS
---------------------------

    ALTA PRIORIDAD (Arreglar Ya):
    1. Fix invoice_type enum/TEXT mismatch
    2. Agregar √≠ndices faltantes en DB (paymentStatus, clientType)
    3. Implementar error boundaries (verificar cobertura completa)
    4. Fix soft delete inconsistency

    MEDIA PRIORIDAD (Arreglar Pronto):
    5. Migrar contacts a clientRelationships
    6. Agregar validaci√≥n y sanitizaci√≥n de inputs
    7. Agregar manejo de errores apropiado
    8. Estandarizar mensajes de error

    BAJA PRIORIDAD (Nice to Have):
    9. Habilitar TypeScript strict mode
    10. Agregar frontend validation consistente
    11. Hardcoded IVA rate a settings
    12. Inconsistent date handling

================================================================================
üí≠ PARA RECONSIDERAR CON PAP√Å
================================================================================

    Servicios Din√°micos - Extensi√≥n Opcional:
    - Actualizar cotizador (quotes/page.tsx) para usar dropdown din√°mico
    - Actualizar displays en listas (order-list.tsx) para cargar desde DB
    - Actualizar exportaci√≥n Excel para usar servicios din√°micos
    
    Nota: Los formularios de pedidos YA usan servicios din√°micos.
    El resto funciona con fallback a labels legacy, pero podr√≠a mejorarse
    para consistencia total del sistema.

================================================================================
                         FIN DEL ROADMAP
================================================================================