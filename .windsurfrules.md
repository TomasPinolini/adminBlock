# AdminBlock - Print Shop Management System

## Project Context
This is a family-run print shop management system in Rosario, Argentina. The business handles various printing services (flyers, banners, business cards, etc.) with dynamic pricing based on supplier materials and profit margins.

## Tech Stack
- **Frontend**: Next.js 16 (App Router), React, TypeScript, TailwindCSS, shadcn/ui
- **Backend**: Supabase (PostgreSQL + Auth), Drizzle ORM
- **State**: Zustand (UI state), TanStack Query (server state)
- **Validation**: Zod schemas
- **Language**: Spanish UI (Argentina locale)

## Code Style & Conventions

### General Rules
- **NO comments or documentation** unless explicitly requested
- Use Spanish for UI text, labels, and user-facing content
- Use English for code (variables, functions, types)
- Prefer concise, functional code over verbose explanations
- Always use TypeScript with strict typing

### File Organization
- API routes: `/src/app/api/[resource]/route.ts`
- Pages: `/src/app/(dashboard)/[page]/page.tsx`
- Components: `/src/components/[feature]/[component].tsx`
- Hooks: `/src/hooks/use-[resource].ts`
- Schema: [/src/lib/db/schema.ts](cci:7://file:///c:/tom/adminBlock/src/lib/db/schema.ts:0:0-0:0) (single source of truth)
- Validation: `/src/lib/validations/[resource].ts`

### Database & Schema
- Use Drizzle ORM for all database operations
- Schema changes MUST be in [/src/lib/db/schema.ts](cci:7://file:///c:/tom/adminBlock/src/lib/db/schema.ts:0:0-0:0)
- Always export types: `export type Resource = typeof resources.$inferSelect`
- Use UUIDs for primary keys: `uuid("id").primaryKey().defaultRandom()`
- Soft deletes use `isActive` or `isArchived` text fields ("true"/"false")
- Always include `createdAt` and `updatedAt` timestamps

### API Routes
- Use Zod for request validation
- Return proper HTTP status codes (200, 201, 404, 500)
- Include error messages in Spanish: `{ error: "Error al..." }`
- Log activity for important actions using `logActivity()`
- Use `createClient()` from `@/lib/supabase/server` for auth

### React Query Hooks
- Pattern: `use[Resource]()`, `useCreate[Resource]()`, `useUpdate[Resource]()`
- Always invalidate related queries on mutations
- Use query keys: `["resource"]`, `["resource", id]`, `["resource", "filter", value]`
- Enable queries conditionally when dependencies exist

### UI Components
- Use shadcn/ui components (Button, Input, Select, Dialog, etc.)
- Mobile-first responsive design (use `lg:` breakpoints)
- Icons from `lucide-react`
- Forms use controlled state with `useState`
- Modals use Zustand store for open/close state

### Business Logic
- **Clients**: Can be "individual" (persona) or "company" (empresa)
- **Orders**: Have status workflow (pending_quote → quoted → approved → in_progress → ready → delivered)
- **Payment**: Track separately from order status (pending, partial, paid)
- **Materials**: Priced per supplier, selected at quote time
- **Quotes**: Can be saved and converted to orders
- **Archive**: Delivered + paid orders can be soft-deleted (archived)

### WhatsApp Integration
- Use `getWhatsAppLink()` for message templates
- Check `isWhatsAppAutoEnabled()` before auto-sending
- Templates in Spanish: orderReady, quoteReady, inProgress, etc.

## Common Patterns

### Creating a new resource
1. Add table to [schema.ts](cci:7://file:///c:/tom/adminBlock/src/lib/db/schema.ts:0:0-0:0) with relations and types
2. Create API routes: [GET](cci:1://file:///c:/tom/adminBlock/src/app/api/materials/%5Bid%5D/route.ts:13:0-41:1), [POST](cci:1://file:///c:/tom/adminBlock/src/app/api/service-materials/route.ts:54:0-83:1) in `/api/[resource]/route.ts`
3. Create API routes: [GET](cci:1://file:///c:/tom/adminBlock/src/app/api/materials/%5Bid%5D/route.ts:13:0-41:1), [PATCH](cci:1://file:///c:/tom/adminBlock/src/app/api/supplier-materials/%5Bid%5D/route.ts:11:0-50:1), [DELETE](cci:1://file:///c:/tom/adminBlock/src/app/api/materials/%5Bid%5D/route.ts:84:0-116:1) in `/api/[resource]/[id]/route.ts`
4. Create Zod validation schemas in `/lib/validations/[resource].ts`
5. Create React Query hooks in `/hooks/use-[resource].ts`
6. Create UI page in `/app/(dashboard)/[resource]/page.tsx`

### Updating schema
1. Modify [schema.ts](cci:7://file:///c:/tom/adminBlock/src/lib/db/schema.ts:0:0-0:0)
2. Provide SQL migration for Supabase (don't use Drizzle migrations)
3. Update API routes to include new fields
4. Update TypeScript types (auto-inferred from schema)
5. Update UI components

### Adding a filter
1. Add to API route as query param: `searchParams.get("filter")`
2. Add to hooks: `FetchResourceParams` interface
3. Add to UI: Zustand store or local state
4. Pass to `useResource({ filter })`

## Important Files
- [/src/lib/db/schema.ts](cci:7://file:///c:/tom/adminBlock/src/lib/db/schema.ts:0:0-0:0) - Single source of truth for database schema
- [/src/stores/ui-store.ts](cci:7://file:///c:/tom/adminBlock/src/stores/ui-store.ts:0:0-0:0) - Global UI state (filters, modals, sidebar)
- [/src/hooks/use-orders.ts](cci:7://file:///c:/tom/adminBlock/src/hooks/use-orders.ts:0:0-0:0) - Order operations and queries
- `/src/hooks/use-clients.ts` - Client operations and queries
- `/src/app/(dashboard)/orders/page.tsx` - Main orders view
- `/improvements.txt` - Feature roadmap and TODOs

## Don't Do
- ❌ Don't add comments unless requested
- ❌ Don't use Drizzle migrations (use raw SQL for Supabase)
- ❌ Don't hardcode API keys (use env vars)
- ❌ Don't create helper scripts or temporary files
- ❌ Don't use English in UI text
- ❌ Don't delete or weaken tests without permission
- ❌ Don't modify multiple unrelated features in one commit

## Do
- ✅ Test with `npm run build` before committing
- ✅ Use Argentina locale for numbers: `toLocaleString("es-AR")`
- ✅ Invalidate React Query caches after mutations
- ✅ Use soft deletes for important data
- ✅ Log activities for audit trail
- ✅ Keep mobile UX in mind (bottom nav, touch targets)
- ✅ Provide SQL migration scripts for schema changes
- ✅ Use existing shadcn/ui components before creating new ones

## Testing Workflow
1. Make changes
2. Run `npm run build` to verify TypeScript and build
3. Test locally if possible
4. Commit with descriptive message in English
5. Push to main branch

## Commit Message Format